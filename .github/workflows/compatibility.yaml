---
name: compat

on:
  pull_request:
  schedule:
    - cron: "0 0 * * 0" # Weekly on Sundays

jobs:
  git-versions:
    name: Git Compatibility (${{ matrix.os }})
    runs-on: ${{ matrix.os }}

    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-20.04, ubuntu-22.04, ubuntu-latest]

    steps:
      - uses: actions/checkout@v4
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y git curl python3-docutils
      - name: Run Tests
        run: make test

  shell-syntax:
    name: Shell Completion Syntax
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
      - name: Install Shells
        run: |
          sudo apt-get update
          sudo apt-get install -y zsh fish
      - name: Generate Completions
        run: make generate
      - name: Check Bash Syntax
        run: bash -n completions/bash/git-remote-gcrypt
      - name: Check Zsh Syntax
        run: zsh -n completions/zsh/_git-remote-gcrypt
      - name: Check Fish Syntax
        run: fish --no-execute completions/fish/git-remote-gcrypt.fish
