---
name: Termux

"on":
  push:
  schedule:
    - cron: "0 0 * * 0" # Sunday at 12 AM

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Fix permissions for Docker
        run: chmod -R 777 .

      - name: Run tests in Termux
        run: |
          docker run --rm \
            -v "$PWD":/app \
            -w /app \
            termux/termux-docker:latest \
            /system/bin/sh -c "export PATH=/data/data/com.termux/files/usr/bin:\$PATH; \
            apt-get update && \
            apt-get install -y git make bash python man && \
            pip install docutils && \
            make install && \
            make check/install && \
            git-remote-gcrypt --version"
